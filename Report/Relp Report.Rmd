---
title: "Relp"
author: "Taikgun Song"
date: "4/29/2017"
header-includes:
   - \usepackage{amsmath}
   - \usepackage{graphicx}
   - \usepackage{bbm}
   - \usepackage{subcaption}
   - \usepackage[export]{adjustbox}
   - \usepackage{wrapfig}
abstract: |
  A popular webpage `yelp.com` was reconstructed into a `shiny` application.  The application focuses on imitating two basic features of the webpage\: providing user-generated reviews and ratings, and providing basic information of the local businesses. The imitation was done by first scraping the `yelp.com` webpage, and re-building the features with interactive visualization and data re-organization via `R` language and `Shiny` application.

output:
  pdf_document:
    fig_caption: yes
    number_sections: no
geometry: margin=0.5in
bibliography: refs.bib
---

```{r hidecode, echo=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, warning=FALSE, message = FALSE, tidy.opts=list(width.cutoff=40))
```

# Introduction
The name of the project re-construction of `yelp.com` using R. `Relp` (reads Re-lp)

building my own web page.

Since the application educational purpose reviewing class materials from STAT585 course.

The application was focused on learning HTML language framework, implementing `R` output into 


# `yelp.com`
`yelp.com` [@yelp] is an online and mobile application providing platforms for internet users to publish reviews and rate local businesses, as well as online delivery service and reservation service.  For the project, only the user-generated reviews and local business information was taken into consideration.  


Some of the basic features of this webpage was reconstructed using the `shiny`[@shiny] application in `R`[@R] framework. 


`shiny`[@shiny], `tidyverse` [@tidyverse], `ggmap` [@ggmap], `leaflet` [@leaflet], `DT` [@DT].

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=5cm]{"yelp_front".png}
\caption{Front page of the `yelp.com` \label{fig:yelp_front}}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=5cm]{"yelp_main".png}
\caption{Main page of the `yelp.com` \label{fig:yelp_main}}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=5cm]{"yelp_rest".png}
\caption{An example of a selected restaurant page on `yelp.com` \label{fig:yelp_rest}}
\end{figure}

```{r check, echo=F, eval=F}
print("ihaveacode")
```

\pagebreak

# Relp
The website was initially scraped using the `rvest`[@rvest] package within the `tidyverse`[@tidyverse] package.

### Front panel
The front page of the `Relp` tried to mimic the front page of the `yelp.com`. As illustraed in \autoref{fig:relp_front}, the page has an image of a delicious dish and a couple of widgets to enter inputs for the application. When the search button is clicked on the real `yelp` front page, the user is directed to a new web page with a list of businesses information. The realization of this feature was constructed on `Relp` by using the conditional panel with the "search"" button to initiate. That is, when the red search icon is clicked with appropriate "Find" and "Near" variable, the shiny application switches its panel to the main panel. The application starts scraping information from the `yelp.com` once the search button is pressed.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=5cm]{"relp_front".png}
\caption{Front page of the Relp application \label{fig:relp_front}}
\end{figure}

### Main panel
The main panel of the `Relp` application consist of two different sections: the input section and the output section. The input section has multiple widgets and is located on the left column of the page. User of the `relp` application could change the "Find" and the "Near" variable, and also filter the price variable.New output could be generated by clicking the "refresh" button. The output section located on the right side of the page with the following three sub-panels: map, review, and image panels. An example of the main page is provided in \autoref{fig:main_panel}. The "Find" and the "Near" variable was changed from "Ames, restaurant" in \autoref{fig:relp_main} to "San Francisco, Bars" in \autoref{fig:relp_map}.


\begin{figure}[h]

\begin{subfigure}{0.5\textwidth}
\includegraphics[width=0.9\linewidth, height=5cm]{"relp_main".png} 
\caption{Initial map panel of the Relp application}
\label{fig:relp_main}
\end{subfigure}
\begin{subfigure}{0.5\textwidth}
\includegraphics[width=0.9\linewidth, height=5cm]{"relp_map".png}
\caption{Map panel of the Relp application with different variables}
\label{fig:relp_map}
\end{subfigure}

\caption{Example of the use of widget on the main page}
\label{fig:main_panel}
\end{figure}

##### Map
Location, price, and average rating are important factors when choosing the right business. These information could be obtain in the map panel. Visualization of the location information is reflected as a map using the `leaflet` package. Other information are organized into a data table by the `DT` package. Interaction between the data table and the map is also established. As illustraied in \autoref{fig:relp_map}, when a row in the data table is highlighted, the corresponding marker on the map changes its color from blue to red.

##### Review
Crowd-sourced reviews and ratings often provide valuable indirect experiences of a business to the users reading the evaluation. The review panel displays phone number, hours of operation, and features of a particular business as well as the crowd-sourced reviews and ratings. An example of the review panel is given in \autoref{fig:relp_review}. When a row of the data table from the map panel is highlighed, the corresponding url of the business is retrieved. The web page of the url is then scraped and re-organized as a shiny web panel.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=6cm]{"relp_review".png}
\caption{Review panel of the Relp application \label{fig:relp_review}}
\end{figure}


##### Images
Pictures of a business is also an important factor when making decisions. The algorithm for generating the image panel is similar to that of the review panel. Image files of a business are first download in a temporary folder. Two action buttons are used to navigate the images. When a new business is selected, files in the temporary forlder are deleted and new images are downloaded. Display of the image panel is portraited in \autoref{fig:relp_image}.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\linewidth, height=6cm]{"relp_image".png}
\caption{Image panel of the Relp application \label{fig:relp_image}}
\end{figure}

### Future work
Although much effort was put into the application to imitate that `yelp.com`, the application is not perfect. There are a few known bugs to be fixed, some `yelp.com` features are omitted, and the cosmetic part may be improved for better display.

##### Fix bugs
First, the application will crash when the Review and Image panel is selected with more than one business.  This is because the script is written for only one selected business url. A simple statement (e.g. the `if` statement) may be applied to check if more than two business urls are chosen as an input, and generate a waring message when the condition is not met.

Second, a script should be updated to un-mark the selected marker on the leaflet output when clicked twice. Current script only marks the chosen input, and no code is written to reverse the selection. A leaflet proxy code could be applied to remove the marker when the business is clicked again.

Third, an error occurs when publishing the application onto the `shinyapps.io`. On the local machine, the application runs smooth without any issues regarding the `leaflet` package. However, uploading the application yields the following message: `ERROR: could not find function "leafletOutput"`. Apparently, similar issues were brought up a couple years ago (2015). One of the suggestion was to load the `leaflet` package on both `ui` and `server`, however, this is not a solution for the case. Other possible source of errors maybe due to the lack of version control or errors generated from `leafletProxy` and `htmlwidgets`.  Further investigation should take place to fix this problem.

##### Add more features


##### Improve speed
##### Beautification

# Conclusion

\pagebreak

#References
